<!doctype html> <html> <head> <meta charset=UTF-8 /> <meta http-equiv=Content-Type content="text/html"/> <title>/code - AsktheRelic.com</title> <link rel=alternate type="application/rss+xml" title="RSS 2.0" href="/code/feed/"/> <link rel=stylesheet media=screen href="/stylesheets/code.css"/> <link rel=stylesheet href='/stylesheets/github.css'/> <link rel="shortcut icon" href="/favicon.ico"> <script src="https://code.jquery.com/jquery-1.12.4.js" integrity="sha256-Qw82+bXyGq6MydymqBxNPYTaUXXq7c8v3CwiYwLLNXU=" crossorigin=anonymous></script> <script src="https://code.jquery.com/ui/1.8.24/jquery-ui.min.js" integrity="sha256-UOoxwEUqhp5BSFFwqzyo2Qp4JLmYYPTHB8l+1yhZij8=" crossorigin=anonymous></script> </head> <body> <div id=container> <div id=container2> <div id=container1> <div id=left> <div id=left-header> <h2><a href="/code">/code - a blog</a></h2> </div> <div id=content> <div id=main_block> <div id=prose_block class=post> <a name=on-easily-replacing-text-in-vim /> <h2 class="blog.post_title"><a href="/2011/04/02/on-easily-replacing-text-in-vim/">On Easily Replacing Text In Vim</a></h2> <small>April 02, 2011 at 03:43 PM</small> <span class=post-prose> <p>Or more specifically: search and replace using the current visual selection.</p> <p>Lately with my job, I&rsquo;ve been spending more time refactoring old code than writing new code. Refactoring and manipulating code (and text) is something that I think Vim is great at, once you really understand the different modes and motions that Vim has, see Stack Overflow <a href="http://stackoverflow.com/questions/1218390/what-is-your-most-productive-shortcut-with-vim">for a good summary</a>. Vim&rsquo;s <a href="http://vim.wikia.com/wiki/Search_and_replace">Search and Replace</a> mode is what I&rsquo;ve primarily been using and while refactoring, I found some Vim tricks I wanted to share.</p> <p>Let&rsquo;s look at normal search and replace usage:</p> <p>Find each occurrence of &lsquo;foo&rsquo;, and replace it with &lsquo;bar&rsquo;.</p> <div class=highlight><pre class="highlight viml"><code><span class="p">:</span>%s<span class="sr">/foo/</span>bar/gc
</code></pre></div> <p>When dealing with complex functions or tricky variable names, I didn&rsquo;t want to type out my function name again into Vim&rsquo;s command line. I wanted a way to visually select my search text and just type my replacement text. I found some help on <a href="http://stackoverflow.com/questions/3619809/how-do-i-insert-the-current-visual-selection-phrase-into-the-command-line">Stack Overflow again</a>, finding out about the <code class=prettyprint>&lt;C-R&gt;&lt;C-W&gt;</code> shortcut to insert the current word under under cursor. The Vim Wikia <a href="http://vim.wikia.com/wiki/VimTip490">explained this shortcut</a> a bit further and I had enough ideas to write something out:</p> <div class=highlight><pre class="highlight plaintext"><code>vmap &lt;Leader&gt;r "sy:%s/&lt;C-R&gt;"s/
</code></pre></div> <p>So, visual map leader key + r to the command: yank the current visual selection to the s register, then go into command line mode, setup a string replace on the current buffer and use <C-R> to load text from the s register. Then you can finish the replace command!</p> <p>My final version include a tip from the Wikia article to run the search string through substitute() to replace newline characters, allowing for multi line/end of line searching. I had to switch to using the @ register format instead of the quote register format for vim to complain though.</p> <div class=highlight><pre class="highlight plaintext"><code>vmap &lt;Leader&gt;r "sy:%s/&lt;C-R&gt;=substitute(@s,"\n",'\\n','g')&lt;CR&gt;/
</code></pre></div> <p>To expand on this command, to find the number of occurrences of the visually selected word, before you run a replace on it:</p> <div class=highlight><pre class="highlight plaintext"><code>vmap &lt;Leader&gt;c "sy:%s/&lt;C-R&gt;=substitute(@s,"\n",'\\n','g')&lt;CR&gt;//n&lt;CR&gt;
</code></pre></div> <p>Other cool search aliases I found in vim:</p> <ul> <li><code class=prettyprint>[I</code> shows all instances of the word under the cursor in the document</li> <li><code class=prettyprint>]I</code> shows all instances of the word under the cursor after your current location</li> </ul> <p>One final tip, regex can be a dangerous tool kids, so always use the confirm flag when replacing!</p> </span> </div> </div> <div class=hr></div> <div> <h4>Recent Articles</h4> <div class="post frontpage"> <span class=linkdate>08 Jan 2017 »</span> <a href="/2017/01/08/hosting-with-dokku/">Hosting with Dokku</a> </div> <div class="post frontpage"> <span class=linkdate>18 Sep 2016 »</span> <a href="/2016/09/18/testing-the-layers-of-your-application-at-pyconuk-2016/">Testing the Layers of Your Application at PyConUK 2016</a> </div> <div class="post frontpage"> <span class=linkdate>21 Apr 2014 »</span> <a href="/2014/04/21/upgrading-my-dotfiles-to-symlinks/">Upgrading My Dotfiles To Symlinks</a> </div> <div class="post frontpage"> <span class=linkdate>08 Feb 2014 »</span> <a href="/2014/02/08/another-year-another-set-of-backups/">Another Year, Another Set Of Backups</a> </div> <div class="post frontpage"> <span class=linkdate>02 Dec 2013 »</span> <a href="/2013/12/02/practical-lessons-learned-from-testing/">Practical Lessons Learned From Testing</a> </div> <div class="post frontpage"> <span class=linkdate>20 Nov 2013 »</span> <a href="/2013/11/20/streaming-small-http-responses-with-python/">Streaming Small HTTP Responses with Python</a> </div> <div class="post frontpage"> <span class=linkdate>03 Nov 2013 »</span> <a href="/2013/11/03/an-exploration-in-selecting-things/">An Exploration In Selecting Things</a> </div> </div> </div> <div class=hr></div> <p id=credits> Powered by <a href="http://middlemanapp.com/">Middleman</a>. <br/> <br/> </p> </div> <div id=right> <div id=right-header> <a href="/"><h1>Ask the Relic</h1></a> </div> </div> </div> </div> </div> </body> </html>