<!doctype html> <html> <head> <meta charset=UTF-8 /> <meta http-equiv=Content-Type content="text/html"/> <title>/code - AsktheRelic.com</title> <link rel=alternate type="application/rss+xml" title="RSS 2.0" href="/code/feed/"/> <link rel=stylesheet media=screen href="/stylesheets/code.css?1472991783"/> <link rel=stylesheet href='/stylesheets/github.css?1472991783'/> <link rel="shortcut icon" href="/favicon.ico"> <script src="https://code.jquery.com/jquery-1.12.4.js" integrity="sha256-Qw82+bXyGq6MydymqBxNPYTaUXXq7c8v3CwiYwLLNXU=" crossorigin=anonymous></script> <script src="https://code.jquery.com/ui/1.8.24/jquery-ui.min.js" integrity="sha256-UOoxwEUqhp5BSFFwqzyo2Qp4JLmYYPTHB8l+1yhZij8=" crossorigin=anonymous></script> </head> <body> <div id=container> <div id=container2> <div id=container1> <div id=left> <div id=left-header> <h2><a href="/code">/code - a blog</a></h2> </div> <div id=content> <div id=main_block> <div id=prose_block class=post> <a name=munin-for-server-stats /> <h2 class="blog.post_title"><a href="/2009/04/08/munin-for-server-stats/">Munin For Server Stats</a></h2> <small>April 08, 2009 at 03:34 PM</small> <span class=post-prose> <p>I switched servers recently, moving from a SliceHost VPS back to a spare machine to try and save some money monthly. One of the final pieces of rebuilding the server was to add a server status page. I tried at first with some php exec calls and command one-liners, but that was pretty limited functionally and required me to handle all the formatting. Then I found <a href="http://munin.projects.linpro.no/">Munin</a>, a script-based monitoring tool that uses RRDTool to create static graphs that you can view through your web server.</p> <p>Several different monitoring tools popped up during my initial search, most being for distributed networks, server farms, or being more dynamic involving CGI scripts that run through Apache. I wasn&rsquo;t happy with those. Munin was simple, creating static JPGs and HTML in a web visible directory. It works having a server poll a set of scripts/plugins that you have running on a client or &ldquo;node&rdquo; every 5 minutes. It records those values into a RRD database, then updates the daily, weekly, monthly and yearly graphs. Plugins are Perl, Python, or any other Bash style scripts. While it does have capabilities for server-farms, you can run the server and node on the same server without a problem. It&rsquo;s taken me only a few hours to setup and tweak things over the last few days and I&rsquo;m quite happy with it. While I&rsquo;m not going to leave my server stats visible to the public, you can <a href="http://munin.ping.uio.no/ping.uio.no/bimbo.ping.uio.no.html">view example output here</a>.</p> <p>After tweaking, the coolest things I have running right now are:</p> <ul> <li><p>Disk usage for my server</p></li> <li><p>SMART values and temperature for my HDD. SMART values are via the <em>smart_sda</em> plugin and temperatures are via the <em>hddtemp_smartctl</em> plugin. For the temp plugin, <a title="http://www.linuxweblog.com/blogs/sandip/20081224/munin-node-plugin-configurations" href="http://www.linuxweblog.com/blogs/sandip/20081224/munin-node-plugin-configurations" target=_blank>this guide</a> was pretty helpful for explaining the values to setup. I had to install <em>smartctl</em> and <em>hddtemp</em> as well for this plugin.</p></li> <li><p>Network traffic for the server via <a title="http://muninexchange.projects.linpro.no/?view&amp;phid=400" href="http://muninexchange.projects.linpro.no/?view&amp;phid=400">vnstat plugin</a> and utility. The default <em>if_</em> plugin that comes with the package seems pretty outdated, so <em>vnstat</em> kicks its ass.</p></li> <li><p>CPU usage, load, memory usage</p></li> <li><p>SSH failed logins/attempted breakins. The installed <em>auth</em> plugin was last updated in 2006, so I had to update a few of the grep string values and bash values to get it to work with Ubuntu. The main value printing section here:</p> <pre class="highlight plaintext"><code>echo -n "illegal_user.value "
echo $(grep "Failed password|Failed none" /var/log/auth.log | grep "`date '+%b %e'`" | wc -l)
echo -n
echo -n "possible_breakin.value "
echo $(grep -i "POSSIBLE BREAK-IN ATTEMPT" /var/log/auth.log | grep "`date '+%b %e'`" | wc -l)
echo -n "authentication_failure.value "
echo $(grep "authentication failure" /var/log/auth.log | grep "`date '+%b %e'`" | wc -l)
</code></pre></li> <li><p>The grep search for &ldquo;failed password&rdquo; and &ldquo;possible break-in&rdquo; had changed, along with the date formatting in the auth.log file (no leading 0 in the date command).</p></li> </ul> <p>As I found by fixing the <em>auth</em> plugin, it&rsquo;s very easy to write plugins. I will probably add my Nginx server requests eventually, but right now, this is enough. Its pretty fun to watch things change over time and review what I was doing on the server to cause a spike in resource usage or memory. It really helps you understand whats going on in the background of the server as well. The long-term value would be watching the yearly SMART graphs for a change in any values, possibly leading to a harddrive malfunction. Logs are great for tracking most things, but graphing really brings easy to read and immediate value.</p> </span> </div> </div> <div class=hr></div> <div> <h4>Recent Articles</h4> <div class="post frontpage"> <span class=linkdate>21 Apr 2014 »</span> <a href="/2014/04/21/upgrading-my-dotfiles-to-symlinks/">Upgrading My Dotfiles To Symlinks</a> </div> <div class="post frontpage"> <span class=linkdate>08 Feb 2014 »</span> <a href="/2014/02/08/another-year-another-set-of-backups/">Another Year, Another Set Of Backups</a> </div> <div class="post frontpage"> <span class=linkdate>02 Dec 2013 »</span> <a href="/2013/12/02/practical-lessons-learned-from-testing/">Practical Lessons Learned From Testing</a> </div> <div class="post frontpage"> <span class=linkdate>20 Nov 2013 »</span> <a href="/2013/11/20/streaming-small-http-responses-with-python/">Streaming Small HTTP Responses with Python</a> </div> <div class="post frontpage"> <span class=linkdate>03 Nov 2013 »</span> <a href="/2013/11/03/an-exploration-in-selecting-things/">An Exploration In Selecting Things</a> </div> <div class="post frontpage"> <span class=linkdate>22 Aug 2013 »</span> <a href="/2013/08/22/the-birthday-surprise/">The Birthday Surprise</a> </div> <div class="post frontpage"> <span class=linkdate>05 Aug 2013 »</span> <a href="/2013/08/05/a-newer-branch/">A Newer Branch</a> </div> </div> </div> <div class=hr></div> <p id=credits> Powered by <a href="http://middlemanapp.com/">Middleman</a>. <br/> <br/> </p> </div> <div id=right> <div id=right-header> <a href="/"><h1>Ask the Relic</h1></a> </div> </div> </div> </div> </div> <script>
  var _gaq = _gaq || [];
  _gaq.push(["_setAccount", "UA-1004202-1"]);
  _gaq.push(["_trackPageview"]);
  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? '//ssl' : '//www') + '.google-analytics.com/ga.js?1472991783';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script> </body> </html>